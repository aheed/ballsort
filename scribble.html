<!doctype html>

<html>
  <head>
    <meta charset="utf-8">
    <title>Ball Sorter</title>
    <style>
        .h-move {
            transition: transform 1s;
        }
    </style>
  </head>
  <body>
    <svg id="movers-svg" height="500" width="500">
        <circle id="c1" class="h-move" cx="50" cy="50" r="16" stroke="black" stroke-width="3" fill="red" />
        Sorry, your browser does not support inline SVG.  
    </svg>
    <br>
    <button id="move-horiz" type="button">&lt;---&gt;</button>
    <button id="move-down" type="button">⬇️</button>
    <div id="status-msg">starting up...</div>
    <script type="module">
      const statusMsg = document.querySelector("#status-msg");
      const c1 = document.querySelector("#c1");
      const hButton = document.querySelector("#move-horiz");
      const downButton = document.querySelector("#move-down");
      const moversSvg = document.querySelector("#movers-svg");
      const hDistance = 150;
      const vDistance = 25;
      const hPositions = 3;
      const vPositions = 5;
      const nofMovers = 20;
      const cb0Min = 0.55;
      const cb0Max = 0.95;
      const cb1Min = 0.1;
      const cb1Max = 0.1;
      const cb2Min = 0.5;
      const cb2Max = 0.6;
      const cb3Min = 1.0;
      const cb3Max = 1.4;

      let hPosIndex = 0;
      let hPos = 0;
      let vPosIndex = 0;
      let vPos = 0;

      const ipol = (index, min, max, maxIndex) => min + index * (max - min) / maxIndex;
      const ipolCurried = (min, max, maxIndex) => (index) => ipol(index, min, max, maxIndex);
      const ipolCurriedMax = (maxIndex) => (min, max) => ipolCurried(min, max, maxIndex);
      const ipolCurriedMaxFun = ipolCurriedMax(nofMovers - 1);
      const ipFun0 = ipolCurriedMaxFun(cb0Min, cb0Max);
      const ipFun1 = ipolCurriedMaxFun(cb1Min, cb1Max);
      const ipFun2 = ipolCurriedMaxFun(cb2Min, cb2Max);
      const ipFun3 = ipolCurriedMaxFun(cb3Min, cb3Max);

      const hMovers = [];
      for (let i=0; i<nofMovers; i++) {
        const mover = document.createElementNS("http://www.w3.org/2000/svg", 'circle');
        mover.setAttribute('stroke', 'none');
        mover.setAttribute('fill', 'black');
        mover.setAttribute('cx', '50');
        mover.setAttribute('cy', `${70 + i * vDistance}`);
        mover.setAttribute('r', '16');
        mover.setAttribute('stroke-width', '3');
        
        const transFun = `cubic-bezier(${ipFun0(i)}, ${ipFun1(i)}, ${ipFun2(i)}, ${ipFun3(i)}`;
        console.log(transFun);
        //mover.style['transition-timing-function'] = 'cubic-bezier(0.1, 0.7, 1.0, 0.1)';
        mover.style['transition-timing-function'] = transFun;
        mover.classList.add('h-move');
        hMovers.push(mover);
      }

      hMovers.forEach(mover => {
        moversSvg.appendChild(mover);
      });

      const updatePositions = () => {
        hPosIndex = (hPosIndex + 1) % hPositions;
        hPos = hPosIndex * hDistance;
        console.log(`hPosIx: ${hPosIndex} hPos:${hPos}`);
        c1.style.transform = `translateX(${hPos}px)`;        
        hMovers.forEach(mover => {
            mover.style.transform = `translateX(${hPos}px)`;
        });
      }

      const horizClickHandler = (e) => {
        console.log("move horizontally");
        updatePositions();
      }

      hButton.addEventListener("click", horizClickHandler);
      hButton.focus();

      console.log("so far so good");
      statusMsg.innerText = "Done!";


    </script>
  </body>
</html>